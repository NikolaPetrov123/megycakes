<!DOCTYPE html>
<html th:replace="~{fragments/layout :: layout (~{::title}, ~{::section})}" lang="en">
<head><title>Cart</title></head>
<body>
<section>
  <h1 class="text-2xl font-bold mb-4">Your Cart</h1>

  <div id="cart-body" th:fragment="cart-body">
    <div th:if="${cart.isEmpty()}">Your cart is empty.</div>

    <div th:unless="${cart.isEmpty()}" class="space-y-2">
      <div th:each="it : ${cart.items}" class="flex items-center justify-between bg-white rounded p-3">
        <div>
          <div class="font-medium" th:text="${it.name}">Name</div>
          <div class="text-sm text-stone-600"
               th:text="${#numbers.formatDecimal(it.getPriceCents()/100.0,1,2)} + ' €'">0.00 €</div>
        </div>

        <form th:action="@{|/cart/update/${it.productId}|}" method="post"
              th:attr="hx-post=@{|/cart/update/${it.productId}|}"
              hx-target="#cart-body" hx-swap="outerHTML" class="flex items-center gap-2">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <input type="number" name="qty" th:value="${it.quantity}" min="0" class="w-16 border rounded px-2 py-1"/>
          <button type="submit" class="px-3 py-1 border rounded">Update</button>
        </form>

        <form th:action="@{|/cart/remove/${it.productId}|}" method="post"
              th:attr="hx-post=@{|/cart/remove/${it.productId}|}"
              hx-target="#cart-body" hx-swap="outerHTML">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button type="submit" class="px-3 py-1 border rounded">Remove</button>
        </form>
      </div>

      <div class="text-right text-xl font-semibold">
        Total: <span th:text="${#numbers.formatDecimal(cart.totalCents()/100.0,1,2)}"></span> €
      </div>
      <div class="flex justify-end mt-4" hx-disable="true">
        <a th:href="@{/checkout}"
           class="inline-block px-4 py-2 bg-stone-800 text-white rounded hover:bg-stone-900">
          Proceed to checkout
        </a>
      </div>
    </div>
    <div id="mini-cart" hx-swap-oob="innerHTML" hidden th:insert="~{fragments/cart-mini :: mini}"></div>
  </div>
</section>
</body>
</html>